<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Change: Data, Trends, and News</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Adding chart animation plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1.0.2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            variants: {
                extend: {
                    display: ['group-open'],
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 1rem;
        }
        .mini-chart-container {
            position: relative;
            height: 100px;
            margin-top: 1rem;
        }
        .prediction-chart-container {
            position: relative;
            height: 150px;
        }
        .control-btn {
            transition: all 0.2s ease;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            background-color: #E5E7EB;
            color: #374151;
            white-space: nowrap;
        }
        .control-btn.active {
            background-color: #4F46E5;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .action-btn {
            background-color: #4F46E5;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease;
        }
        .action-btn:hover {
            background-color: #4338CA;
        }
        .action-btn:disabled {
            background-color: #A5B4FC;
            cursor: not-allowed;
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #E5E7EB;
            border-bottom-color: #4F46E5;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 50;
        }
        .modal-content {
            background-color: white; padding: 2rem; border-radius: 0.75rem; max-width: 90%; width: 600px; max-height: 80vh; overflow-y: auto;
        }
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        .hotspot-map {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: auto;
        }
        .hotspot {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }
        .hotspot-dot {
            width: 16px;
            height: 16px;
            background-color: rgba(239, 68, 68, 0.7);
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .hotspot-label {
            display: none;
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #111827;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            white-space: nowrap;
            z-index: 10;
        }
        .hotspot:hover .hotspot-label {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold text-gray-900">Climate Change Dashboard</h1>
            <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Explore historical data, understand the science, simulate future scenarios, and see the latest news.</p>
        </header>

        <main class="space-y-16">
            <!-- Economic Impacts Section -->
            <section id="economic-impacts">
                <h2 class="text-3xl font-bold text-center mb-8">The Projected Economic Cost of Climate Change</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div class="card p-6 text-center">
                        <h3 class="text-xl font-semibold">Infrastructure Damage</h3>
                        <p class="text-gray-600 text-sm">Annual cost from extreme weather</p>
                        <div class="mini-chart-container"><canvas id="infraCostChart"></canvas></div>
                        <button class="control-btn text-xs mt-4 mx-auto synopsis-trigger" data-synopsis-topic="Infrastructure Costs">Learn More</button>
                    </div>
                    <div class="card p-6 text-center">
                        <h3 class="text-xl font-semibold">Agricultural Losses</h3>
                        <p class="text-gray-600 text-sm">Annual losses in crop yields</p>
                        <div class="mini-chart-container"><canvas id="agriCostChart"></canvas></div>
                        <button class="control-btn text-xs mt-4 mx-auto synopsis-trigger" data-synopsis-topic="Agricultural Losses">Learn More</button>
                    </div>
                    <div class="card p-6 text-center">
                        <h3 class="text-xl font-semibold">Healthcare Costs</h3>
                        <p class="text-gray-600 text-sm">Annual direct health costs</p>
                        <div class="mini-chart-container"><canvas id="healthCostChart"></canvas></div>
                        <button class="control-btn text-xs mt-4 mx-auto synopsis-trigger" data-synopsis-topic="Healthcare Costs">Learn More</button>
                    </div>
                    <div class="card p-6 text-center">
                        <h3 class="text-xl font-semibold">Productivity Loss</h3>
                        <p class="text-gray-600 text-sm">Global GDP loss from heat stress</p>
                        <div class="mini-chart-container"><canvas id="productivityCostChart"></canvas></div>
                        <button class="control-btn text-xs mt-4 mx-auto synopsis-trigger" data-synopsis-topic="Productivity Loss">Learn More</button>
                    </div>
                </div>
            </section>

            <!-- Solutions & Innovations Section -->
            <section id="solutions">
                <h2 class="text-3xl font-bold text-center mb-8">Solutions & Innovations</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card p-6 text-center">
                        <h3 class="text-xl font-semibold">Carbon Capture Growth</h3>
                        <p class="text-gray-600 text-sm">Megatons of CO₂ captured annually</p>
                        <div class="mini-chart-container"><canvas id="carbonCaptureChart"></canvas></div>
                    </div>
                    <div class="card p-6 text-center">
                        <h3 class="text-xl font-semibold">Reforestation Efforts</h3>
                        <p class="text-gray-600 text-sm">Million hectares reforested globally</p>
                        <div class="mini-chart-container"><canvas id="reforestationChart"></canvas></div>
                    </div>
                    <div class="card p-6 text-center md:col-span-2 lg:col-span-1">
                        <h3 class="text-xl font-semibold">Green Tech Investment</h3>
                        <p class="text-gray-600 text-sm">Annual global investment (Trillion USD)</p>
                        <div class="mini-chart-container"><canvas id="greenTechChart"></canvas></div>
                    </div>
                </div>
            </section>

            <!-- Detailed Charts Section -->
            <section id="detailed-charts">
                <h2 class="text-3xl font-bold text-center mb-8">In-Depth Data Visualizations</h2>
                <div class="grid md:grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold">800,000 Years of CO₂ History</h3>
                        <p class="text-sm text-gray-600">The recent spike is unprecedented.</p>
                        <div class="chart-container"><canvas id="longCo2Chart"></canvas></div>
                        <button class="control-btn text-xs mt-4 mx-auto synopsis-trigger" data-synopsis-topic="CO2 History">Learn More</button>
                    </div>
                    <div class="card p-6">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-semibold">Electricity Generation Mix</h3>
                            <select id="country-filter" class="p-2 border rounded-md bg-gray-50 text-sm">
                                <!-- Options will be populated by JS -->
                            </select>
                        </div>
                        <p class="text-sm text-gray-600">Share of fuels used for power plants (2023).</p>
                        <div class="chart-container"><canvas id="energyMixChart"></canvas></div>
                        <button class="control-btn text-xs mt-4 mx-auto synopsis-trigger" data-synopsis-topic="Energy Mix">Learn More</button>
                    </div>
                </div>
            </section>

            <!-- Global Climate Hotspots Section -->
            <section id="hotspots">
                <h2 class="text-3xl font-bold text-center mb-8">Global Climate Hotspots</h2>
                <div class="hotspot-map bg-white p-4 rounded-lg shadow-lg">
                    <img src="https://placehold.co/600x300/EBF4FF/3B82F6?text=World+Map" alt="World map" class="w-full h-auto">
                    <div class="hotspot" style="top: 25%; left: 18%;"><div class="hotspot-dot"></div><span class="hotspot-label">Arctic: Rapid Warming</span></div>
                    <div class="hotspot" style="top: 40%; left: 50%;"><div class="hotspot-dot"></div><span class="hotspot-label">Sahel: Desertification</span></div>
                    <div class="hotspot" style="top: 45%; left: 25%;"><div class="hotspot-dot"></div><span class="hotspot-label">Amazon: Deforestation</span></div>
                    <div class="hotspot" style="top: 65%; left: 85%;"><div class="hotspot-dot"></div><span class="hotspot-label">Pacific Islands: Sea-Level Rise</span></div>
                    <div class="hotspot" style="top: 75%; left: 80%;"><div class="hotspot-dot"></div><span class="hotspot-label">Australia: Wildfires & Bleaching</span></div>
                </div>
            </section>
            
            <!-- Climate Fundamentals Section -->
            <section id="climate-fundamentals">
                <h2 class="text-3xl font-bold text-center mb-8">Climate Fundamentals Explained</h2>
                <div class="space-y-6 max-w-4xl mx-auto">
                     <details class="bg-white p-6 rounded-lg shadow-sm transition-all duration-300 ease-in-out">
                        <summary class="flex justify-between items-center font-semibold text-xl text-gray-900 cursor-pointer">
                            <span>Verifying Climate Claims: The Scientific Consensus</span>
                            <svg class="w-6 h-6 text-gray-500 arrow-down" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div class="mt-4 text-gray-700 space-y-4">
                            <p>The scientific consensus, based on overwhelming evidence, is that Earth's climate is warming at an unprecedented rate and that human activities are the primary driver. This conclusion is supported by numerous independent scientific organizations worldwide.</p>
                        </div>
                    </details>

                    <details class="bg-white p-6 rounded-lg shadow-sm transition-all duration-300 ease-in-out">
                        <summary class="flex justify-between items-center font-semibold text-xl text-gray-900 cursor-pointer">
                            <span>Accuracy of Climate Predictions</span>
                             <svg class="w-6 h-6 text-gray-500 arrow-down" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div class="mt-4 text-gray-700 space-y-4">
                            <p>Climate models, while complex, have proven to be remarkably accurate in their long-term predictions. Early models from the 1970s accurately predicted the current warming trend, and today's sophisticated models consistently forecast the overall trajectory of global warming.</p>
                        </div>
                    </details>

                    <details class="bg-white p-6 rounded-lg shadow-sm transition-all duration-300 ease-in-out" open>
                        <summary class="flex justify-between items-center font-semibold text-xl text-gray-900 cursor-pointer">
                            <span>Population Growth vs. Climate Impact</span>
                             <svg class="w-6 h-6 text-gray-500 arrow-down" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div class="mt-4 text-gray-700 space-y-4">
                            <p>The number of people affected by extreme weather is rising due to both increasing event severity and global population growth, which places more people in vulnerable areas.</p>
                            <div class="my-6 p-4 border border-gray-200 rounded-lg bg-gray-50">
                                <h3 class="font-semibold text-lg mb-2 text-center">Global Population & People Affected by Weather Disasters</h3>
                                <div class="chart-container" style="height: 250px;"><canvas id="populationDisasterChart"></canvas></div>
                            </div>
                        </div>
                    </details>
                </div>
            </section>

            <!-- Prediction Simulation Section -->
            <section id="simulation" class="bg-white p-8 rounded-lg shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-4">Future Prediction Simulator</h2>
                <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">Select a viewpoint, adjust the sliders, and see how different emission scenarios could impact our world.</p>
                <div class="grid lg:grid-cols-5 gap-8 items-start">
                    <div class="lg:col-span-2 space-y-6">
                        <div>
                            <label for="persona-select" class="block text-lg font-medium">Viewpoint:</label>
                            <select id="persona-select" class="w-full p-2 mt-2 border rounded-md bg-gray-50 text-base">
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                        <div>
                            <label for="year-slider" class="block text-lg font-medium">Prediction Year: <span id="year-value" class="font-bold text-indigo-600">2050</span></label>
                            <input id="year-slider" type="range" min="2030" max="2100" value="2050" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                        </div>
                        <div>
                            <label for="emissions-slider" class="block text-lg font-medium">Emissions Scenario: <span id="emissions-label" class="font-bold text-indigo-600">Moderate</span></label>
                            <input id="emissions-slider" type="range" min="1" max="3" value="2" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2">
                            <div class="flex flex-col text-sm text-gray-500 mt-1"><span>1: Low</span> <span>2: Moderate</span> <span>3: High</span></div>
                        </div>
                        <button id="generate-scenario-synopsis-btn" class="w-full action-btn py-3">Get Persona Synopsis</button>
                    </div>
                    <div class="lg:col-span-3 grid grid-cols-2 gap-4">
                        <div class="card p-3"><h4 class="text-center font-semibold text-sm">Temperature Anomaly</h4><div class="prediction-chart-container"><canvas id="tempPredictionChart"></canvas></div></div>
                        <div class="card p-3"><h4 class="text-center font-semibold text-sm">Sea Level Rise</h4><div class="prediction-chart-container"><canvas id="seaPredictionChart"></canvas></div></div>
                        <div class="card p-3"><h4 class="text-center font-semibold text-sm">Heatwave Increase</h4><div class="prediction-chart-container"><canvas id="heatwavePredictionChart"></canvas></div></div>
                        <div class="card p-3"><h4 class="text-center font-semibold text-sm">Storm Intensity</h4><div class="prediction-chart-container"><canvas id="stormPredictionChart"></canvas></div></div>
                    </div>
                </div>
            </section>

            <!-- News Feed Section -->
            <section id="news">
                <h2 class="text-3xl font-bold text-center mb-8">Latest Global Climate News</h2>
                <div class="max-w-4xl mx-auto space-y-4">
                    <div class="space-y-4 md:space-y-0 md:flex md:justify-between md:items-center">
                        <div id="news-categories" class="flex flex-wrap justify-center md:justify-start gap-2">
                            <button data-category="Top Stories" class="control-btn active">Top Stories</button><button data-category="Extreme Weather" class="control-btn">Weather</button><button data-category="Policy & Activism" class="control-btn">Policy</button><button data-category="Scientific Research" class="control-btn">Science</button>
                        </div>
                         <div id="news-date-ranges" class="flex flex-wrap justify-center md:justify-end gap-2">
                            <button data-range="week" class="control-btn text-xs">Week</button><button data-range="month" class="control-btn text-xs">Month</button><button data-range="year" class="control-btn active text-xs">Year</button><button data-range="5y" class="control-btn text-xs">5 Years</button>
                        </div>
                    </div>
                     <div class="flex justify-center pt-2">
                        <button id="get-news-btn" class="action-btn w-full sm:w-auto">Get Global News</button>
                    </div>
                    <div id="news-feed-container" class="pt-4">
                        <div id="news-loader" class="text-center hidden"><div class="loader mx-auto"></div><p class="mt-4 text-gray-600">Fetching news...</p></div>
                        <div id="news-feed" class="space-y-4"></div>
                        <div id="news-error" class="hidden text-center text-red-500 mt-4"><p>Could not fetch news.</p></div>
                        <div class="text-center mt-6">
                            <button id="load-more-news-btn" class="action-btn hidden">Load More</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-16 py-6 border-t"><p class="text-gray-600">Illustration by Gemini. Data from public sources (NOAA, NASA, IEA, EM-DAT). News powered by Google AI.</p></footer>

        <div id="synopsis-modal" class="modal-overlay hidden"><div class="modal-content"><div class="flex justify-between items-center mb-4"><h3 id="modal-title" class="text-2xl font-bold">AI Expert Synopsis</h3><button id="close-modal-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button></div><div id="synopsis-content" class="text-gray-700 space-y-4"></div></div></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Chart Instances & Data ---
        let energyMixChart, tempPredictionChart, seaPredictionChart, heatwavePredictionChart, stormPredictionChart;
        const economicData = { labels: [2025, 2030, 2040, 2050, 2060, 2070, 2100], infra: { data: [0.8, 1.0, 1.5, 2.2, 3.5, 5.0, 12.0], color: '#EF4444', unit: 'Trillion USD' }, agri: { data: [0.4, 0.5, 0.7, 1.1, 1.8, 2.7, 7.5], color: '#F59E0B', unit: 'Trillion USD' }, health: { data: [0.004, 0.008, 0.02, 0.05, 0.1, 0.2, 0.5], color: '#3B82F6', unit: 'Trillion USD' }, productivity: { data: [0.5, 0.8, 1.5, 2.5, 4.0, 6.0, 15.0], color: '#8B5CF6', unit: '% GDP Loss' } };
        const solutionsData = { labels: [2020, 2021, 2022, 2023, 2024, 2025], carbonCapture: { data: [40, 42, 45, 50, 60, 75], color: '#6366F1' }, reforestation: { data: [5.8, 6.1, 6.5, 7.0, 7.6, 8.3], color: '#10B981' }, greenTech: { data: [0.9, 1.1, 1.5, 1.8, 2.2, 2.7], color: '#FBBF24' } };
        const longCo2Data = { labels: [-800000, -600000, -400000, -200000, -10000, 1800, 1950, 2024], values: [180, 220, 190, 250, 260, 280, 310, 422] };
        const countryList = ['World', 'China', 'USA', 'India', 'EU27', 'New Zealand', 'Australia', 'Austria', 'Belgium', 'Canada', 'Chile', 'Colombia', 'Costa Rica', 'Czech Republic', 'Denmark', 'Estonia', 'Finland', 'France', 'Germany', 'Greece', 'Hungary', 'Iceland', 'Ireland', 'Israel', 'Italy', 'Japan', 'Korea', 'Latvia', 'Lithuania', 'Luxembourg', 'Mexico', 'Netherlands', 'Norway', 'Poland', 'Portugal', 'Slovak Republic', 'Slovenia', 'Spain', 'Sweden', 'Switzerland', 'Türkiye', 'United Kingdom'].sort();
        const energyMixData = { labels: ['Coal', 'Gas', 'Hydro', 'Nuclear', 'Wind & Solar', 'Other'], World: [35.4, 22.7, 14.9, 9.1, 13.4, 4.5], China: [59.1, 3.4, 13.5, 4.9, 15.6, 3.5], USA: [19.5, 43.1, 5.7, 18.2, 14.5, 9.0], India: [74.2, 2.5, 9.4, 2.0, 9.9, 2.0], EU27: [12.4, 16.9, 11.4, 22.0, 27.0, 10.3], NewZealand: [3.5, 10.5, 56.5, 0, 22.5, 7.0], OECDAverage: [25.1, 28.3, 13.5, 17.5, 11.1, 4.5] };
        countryList.forEach(c => { if (!energyMixData[c.replace(/\s/g, '')]) energyMixData[c.replace(/\s/g, '')] = energyMixData.OECDAverage; });
        const populationDisasterData = { labels: ['1980', '1985', '1990', '1995', '2000', '2005', '2010', '2015', '2020', '2024'], population: [4.45, 4.85, 5.30, 5.72, 6.12, 6.51, 6.92, 7.35, 7.79, 8.1], affected: [75, 90, 120, 150, 210, 240, 260, 300, 350, 380] };

        // --- Hardcoded Synopsis Texts ---
        const synopsisTexts = {
            'Infrastructure Costs': 'As climate change intensifies, so does the frequency and severity of extreme weather events. More powerful hurricanes and typhoons bring destructive winds and storm surges, while intense rainfall leads to widespread flooding. This damages and destroys critical infrastructure like roads, bridges, ports, and power grids. The cumulative cost of repairing, rebuilding, and adapting this infrastructure represents a multi-trillion dollar challenge.',
            'Agricultural Losses': 'Agriculture is exceptionally vulnerable to climate change. Droughts, extreme rainfall, and rising temperatures reduce crop yields and stress livestock. Pests and diseases are also migrating to new regions. These combined pressures threaten global food security and create immense financial volatility for farmers and the entire food supply chain.',
            'Healthcare Costs': 'The link between climate change and human health is direct and multifaceted. Heatwaves drive heatstroke and cardiovascular stress. Worsening air quality from wildfires exacerbates respiratory conditions. Warmer climates also expand the range of disease vectors like mosquitoes and ticks, increasing illnesses like dengue fever and Lyme disease.',
            'Productivity Loss': 'Rising global temperatures directly impact economic productivity through "heat stress." When it is too hot to work safely, especially in sectors like agriculture and construction, worker output declines. This leads to significant reductions in output, translating to trillions of dollars in lost economic value.',
            'CO2 History': 'For 800,000 years, atmospheric CO₂ levels naturally fluctuated between about 180-280 parts per million (ppm). Since the Industrial Revolution, human activities have caused levels to skyrocket past 420 ppm, a level not seen in millions of years. This abrupt spike breaks the natural cycle and is the primary driver of rapid global warming.',
            'Energy Mix': 'The electricity generation mix is a critical indicator of a country\'s contribution to climate change. To combat climate change, a rapid transition from fossil fuels like coal and gas to low-carbon sources like wind, solar, hydropower, and nuclear energy is essential for decarbonizing the power grid.'
        };

        // --- Chart Rendering ---
        const chartOptions = { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, deferred: { yOffset: '50%', delay: 500 } }, scales: { x: { ticks: { maxRotation: 0, minRotation: 0, autoSkip: true, maxTicksLimit: 7 } } } };
        function createEconomicChart(canvasId, data, unit) { new Chart(document.getElementById(canvasId).getContext('2d'), { type: 'line', data: { labels: economicData.labels, datasets: [{ data: data.data, borderColor: data.color, fill: true, backgroundColor: `${data.color}33`, tension: 0.4 }] }, options: { ...chartOptions, scales: { ...chartOptions.scales, y: { ticks: { callback: (v) => `${v}${unit.startsWith('T') ? 'T' : '%'}` } } }, plugins: { ...chartOptions.plugins, tooltip: { callbacks: { label: (c) => `${c.formattedValue} ${unit}` } } } } }); }
        createEconomicChart('infraCostChart', economicData.infra, economicData.infra.unit); createEconomicChart('agriCostChart', economicData.agri, economicData.agri.unit); createEconomicChart('healthCostChart', economicData.health, economicData.health.unit); createEconomicChart('productivityCostChart', economicData.productivity, economicData.productivity.unit);
        
        function createSolutionChart(canvasId, data, color) { new Chart(document.getElementById(canvasId).getContext('2d'), { type: 'bar', data: { labels: solutionsData.labels, datasets: [{ data: data, backgroundColor: color }] }, options: chartOptions }); }
        createSolutionChart('carbonCaptureChart', solutionsData.carbonCapture.data, solutionsData.carbonCapture.color);
        createSolutionChart('reforestationChart', solutionsData.reforestation.data, solutionsData.reforestation.color);
        createSolutionChart('greenTechChart', solutionsData.greenTech.data, solutionsData.greenTech.color);

        new Chart(document.getElementById('longCo2Chart').getContext('2d'), { type: 'line', data: { labels: longCo2Data.labels, datasets: [{ label: 'CO₂ (ppm)', data: longCo2Data.values, borderColor: '#EF4444', tension: 0.1 }] }, options: { ...chartOptions, scales: { x: { type: 'linear', ticks: { callback: (v) => v < 0 ? `${-v/1000}k` : v, autoSkip: true, maxTicksLimit: 8 } } } } });
        new Chart(document.getElementById('populationDisasterChart').getContext('2d'), { type: 'bar', data: { labels: populationDisasterData.labels, datasets: [{ type: 'line', label: 'World Population (Billions)', data: populationDisasterData.population, borderColor: '#3B82F6', backgroundColor: '#3B82F6', yAxisID: 'y-population', tension: 0.1, fill: false }, { type: 'bar', label: 'People Affected by Disasters (Millions)', data: populationDisasterData.affected, backgroundColor: '#F59E0B', borderColor: '#F59E0B', yAxisID: 'y-disasters' }] }, options: { ...chartOptions, scales: { 'y-population': { type: 'linear', position: 'left', title: { display: true, text: 'World Population (Billions)' }, grid: { drawOnChartArea: false } }, 'y-disasters': { type: 'linear', position: 'right', title: { display: true, text: 'People Affected (Millions)' } }, x: { ticks: { maxRotation: 0, minRotation: 0, autoSkip: true, maxTicksLimit: 10 } } }, plugins: { ...chartOptions.plugins, tooltip: { callbacks: { label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } if (context.parsed.y !== null) { const unit = context.dataset.yAxisID === 'y-population' ? ' Billion' : ' Million'; label += context.parsed.y + unit; } return label; } } } } } });

        // --- Country Filter Population ---
        const countryFilter = document.getElementById('country-filter');
        countryList.forEach(c => {
            const option1 = document.createElement('option'); option1.value = c.replace(/\s/g, ''); option1.textContent = c; if (c === 'World') option1.selected = true; countryFilter.appendChild(option1);
        });

        // --- Energy Mix Chart Logic ---
        function renderEnergyMixChart(country) { if (energyMixChart) energyMixChart.destroy(); energyMixChart = new Chart(document.getElementById('energyMixChart').getContext('2d'), { type: 'doughnut', data: { labels: energyMixData.labels, datasets: [{ data: energyMixData[country], backgroundColor: ['#1F2937', '#4B5563', '#3B82F6', '#8B5CF6', '#10B981', '#F59E0B'] }] }, options: { ...chartOptions, plugins: { ...chartOptions.plugins, legend: { position: 'bottom' } } } }); }
        countryFilter.addEventListener('change', (e) => renderEnergyMixChart(e.target.value));
        renderEnergyMixChart('World');

        // --- Prediction Simulator Logic ---
        const yearSlider = document.getElementById('year-slider');
        const emissionsSlider = document.getElementById('emissions-slider');
        const yearValue = document.getElementById('year-value');
        const emissionsLabel = document.getElementById('emissions-label');
        const emissionsMap = { 1: 'Low', 2: 'Moderate', 3: 'High' };
        function createPredictionChart(canvasId, label, color) { return new Chart(document.getElementById(canvasId).getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label, data: [], borderColor: color, tension: 0.4, fill: true, backgroundColor: `${color}33` }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, deferred: false }, scales: { y: { beginAtZero: true }, x: { ticks: { maxRotation: 0, minRotation: 0, autoSkip: true, maxTicksLimit: 5 } } } } }); }
        tempPredictionChart = createPredictionChart('tempPredictionChart', 'Temp Anomaly (°C)', '#EF4444');
        seaPredictionChart = createPredictionChart('seaPredictionChart', 'Sea Level Rise (cm)', '#3B82F6');
        heatwavePredictionChart = createPredictionChart('heatwavePredictionChart', 'Heatwave Increase (%)', '#F59E0B');
        stormPredictionChart = createPredictionChart('stormPredictionChart', 'Storm Intensity (%)', '#8B5CF6');
        function updatePredictionCharts() {
            const year = parseInt(yearSlider.value); const emissions = parseInt(emissionsSlider.value);
            emissionsLabel.textContent = emissionsMap[emissions]; yearValue.textContent = year;
            const baseValues = { temp: 1.2, sea: 24, heatwave: 50, storm: 10 };
            const multipliers = { 1: { temp: 0.015, sea: 0.2, heatwave: 0.8, storm: 0.3 }, 2: { temp: 0.025, sea: 0.4, heatwave: 1.5, storm: 0.6 }, 3: { temp: 0.04, sea: 0.7, heatwave: 2.5, storm: 1.0 } };
            const currentYear = new Date().getFullYear(); const years = Array.from({ length: year - currentYear + 1 }, (_, i) => currentYear + i);
            function generateData(base, multiplier, years) { return years.map((y, i) => parseFloat((base + (multiplier * i)).toFixed(2))); }
            tempPredictionChart.data.labels = years; tempPredictionChart.data.datasets[0].data = generateData(baseValues.temp, multipliers[emissions].temp, years);
            seaPredictionChart.data.labels = years; seaPredictionChart.data.datasets[0].data = generateData(baseValues.sea, multipliers[emissions].sea, years);
            heatwavePredictionChart.data.labels = years; heatwavePredictionChart.data.datasets[0].data = generateData(baseValues.heatwave, multipliers[emissions].heatwave, years);
            stormPredictionChart.data.labels = years; stormPredictionChart.data.datasets[0].data = generateData(baseValues.storm, multipliers[emissions].storm, years);
            [tempPredictionChart, seaPredictionChart, heatwavePredictionChart, stormPredictionChart].forEach(c => c.update());
        }
        yearSlider.addEventListener('input', updatePredictionCharts);
        emissionsSlider.addEventListener('input', updatePredictionCharts);
        updatePredictionCharts();

        // --- Modal & Synopsis Logic ---
        const modal = document.getElementById('synopsis-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const synopsisContent = document.getElementById('synopsis-content');
        const modalTitle = document.getElementById('modal-title');
        function showModal(content, title = 'Synopsis') { modalTitle.textContent = title; synopsisContent.innerHTML = content; modal.classList.remove('hidden'); }
        function hideModal() { modal.classList.add('hidden'); }
        closeModalBtn.addEventListener('click', hideModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) hideModal(); });
        document.querySelectorAll('.synopsis-trigger').forEach(btn => { btn.addEventListener('click', () => { const topic = btn.dataset.synopsisTopic; const text = synopsisTexts[topic] || 'Synopsis not available.'; showModal(`<p>${text.replace(/\n/g, '</p><p>')}</p>`, topic); }); });
        
        const personaSelect = document.getElementById('persona-select');
        const personas = {
            'climatologist': 'Climatologist', 'marine_biologist': 'Marine Biologist', 'economist': 'Economist', 'politician': 'Politician', 'environmentalist': 'Environmentalist', 'child': 'Child (10 y/o)', 'parent': 'Parent', 'grandparent': 'Grandparent', 'fossil_fuel_lobbyist': 'Fossil Fuel Lobbyist', 'donald_trump': 'Donald Trump', 'comedian': 'Comedian'
        };
        for (const key in personas) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = personas[key];
            personaSelect.appendChild(option);
        }

        function getPersonaSynopsis(persona, year, scenario) {
            const scenariosText = {
                Low: { temp: "stabilizing around 1.5°C", impact: "the worst impacts have been averted through significant global cooperation and technological innovation", feeling: "cautious optimism", link: '#solutions' },
                Moderate: { temp: "surpassing 2°C", impact: "frequent and intense heatwaves, droughts, and storms are the new normal, causing significant disruption to food supplies and displacing millions", feeling: "deep concern", link: '#economic-impacts' },
                High: { temp: "soaring past 3°C", impact: "catastrophic and irreversible tipping points have been triggered. Vast regions are becoming uninhabitable, leading to widespread famine, conflict, and societal collapse", feeling: "grave alarm", link: '#hotspots' }
            };
            const s = scenariosText[scenario];
            let synopsisText = "";
            
            switch(persona) {
                case 'climatologist': synopsisText = `Based on the data for a ${scenario} emissions pathway, by ${year}, we project global mean temperatures ${s.temp}. This corresponds to a state where ${s.impact}. My sentiment is one of ${s.feeling}.`; break;
                case 'economist': synopsisText = `In a ${scenario} emissions world, the economic outlook for ${year} is defined by massive externalities. We're looking at trillions in costs from infrastructure damage and lost productivity. Carbon pricing and green investments become the only viable path to mitigate further losses.`; break;
                case 'environmentalist': synopsisText = `By ${year}, if we follow this ${scenario} path, we have failed. The ${s.impact} is a direct result of greed and inaction. We must demand immediate, radical change to decarbonize our society and restore our ecosystems.`; break;
                default: synopsisText = `Viewing the ${scenario} scenario for ${year}, my primary thought is about the ${s.impact}.`;
            }
            return `${synopsisText} <br><br><a href="${s.link}" onclick="hideModal()" class="text-indigo-600 font-bold hover:underline">See related data &rarr;</a>`;
        }

        document.getElementById('generate-scenario-synopsis-btn').addEventListener('click', () => {
            const year = yearSlider.value;
            const scenario = emissionsMap[emissionsSlider.value];
            const persona = personaSelect.value;
            const personaName = personas[persona];
            const synopsis = getPersonaSynopsis(persona, year, scenario);
            showModal(synopsis, `Synopsis for ${year} (${scenario}) - Viewpoint: ${personaName}`);
        });

        // --- News Feed Logic ---
        const newsFeedContainer = document.getElementById('news-feed');
        const newsLoader = document.getElementById('news-loader');
        const getNewsBtn = document.getElementById('get-news-btn');
        const loadMoreBtn = document.getElementById('load-more-news-btn');
        const articlesPerPage = 5;
        let currentNewsPage = 1;
        let currentNewsQuery = "";

        async function fetchNewsFromAI(query, page) {
            // This function simulates calling the Gemini API
            const prompt = `Generate a JSON array of ${articlesPerPage} unique, realistic global climate change news headlines and summaries based on the query: "${query}". Each item should have "date", "title", "content", and "category" fields. The date should be a realistic date within the last 5 years. The category must be one of: "Top Stories", "Extreme Weather", "Policy & Activism", "Scientific Research". Do not repeat articles. For page ${page}, generate new, different articles.`;
            
            console.log("Simulating AI News Fetch with prompt:", prompt);
            
            // In a real application, this would be a fetch call to the Gemini API.
            // For this simulation, we'll generate mock data based on the query.
            await new Promise(resolve => setTimeout(resolve, 1200)); // Simulate network delay
            
            const categories = ["Top Stories", "Extreme Weather", "Policy & Activism", "Scientific Research"];
            const baseTitles = {
                "Top Stories": ["Global CO2 Levels Reach New High", "Renewable Energy Investment Breaks Record", "Major Corporations Announce Net-Zero Pledges"],
                "Extreme Weather": ["Unprecedented Heatwave Grips Southern Europe", "Category 5 Hurricane Makes Landfall", "Decade-Long Drought Sparks Water Crisis"],
                "Policy & Activism": ["UN Climate Summit Ends in Stalemate", "Youth Activists Stage Global Climate Strike", "New Carbon Tax Legislation Proposed"],
                "Scientific Research": ["Antarctic Ice Shelf Collapse Imminent, Study Finds", "New Evidence Links Methane to Permafrost Thaw", "Ocean Acidification Accelerating, Report Warns"]
            };

            const queryCategory = categories.find(c => query.toLowerCase().includes(c.toLowerCase().split(' ')[0])) || "Top Stories";
            
            let articles = [];
            for (let i = 0; i < articlesPerPage; i++) {
                const titleTemplate = baseTitles[queryCategory][i % baseTitles[queryCategory].length];
                const now = new Date();
                const randomDaysAgo = Math.floor(Math.random() * 365 * 5);
                const date = new Date(now.setDate(now.getDate() - randomDaysAgo)).toISOString().split('T')[0];

                articles.push({
                    date: date,
                    title: `${titleTemplate} (Page ${page}, Item ${i+1})`,
                    content: `This is a dynamically generated summary for the article titled "${titleTemplate}". It elaborates on the key points and provides context for the simulated news event, demonstrating a live AI response.`,
                    category: queryCategory
                });
            }
            return articles;
        }

        async function fetchNews(page = 1) {
            newsLoader.classList.remove('hidden');
            loadMoreBtn.classList.add('hidden');
            getNewsBtn.disabled = true;
            getNewsBtn.textContent = 'Fetching...';

            if (page === 1) {
                newsFeedContainer.innerHTML = '';
            }

            const category = document.querySelector('#news-categories .active').dataset.category;
            const dateRange = document.querySelector('#news-date-ranges .active').dataset.range;
            currentNewsQuery = `Global climate news about ${category} from the last ${dateRange.replace('y', ' years')}`;

            try {
                const articles = await fetchNewsFromAI(currentNewsQuery, page);

                if (articles.length === 0 && page === 1) {
                    newsFeedContainer.innerHTML = '<p class="text-center text-gray-500">No news found for the selected criteria.</p>';
                } else {
                    articles.forEach(article => {
                        const articleEl = document.createElement('div');
                        articleEl.className = 'card p-4';
                        const formattedDate = new Date(article.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
                        const synopsis = article.content.split('. ')[0] + '.';

                        articleEl.innerHTML = `
                            <details class="group">
                                <summary class="list-none cursor-pointer">
                                    <div class="flex justify-between items-start gap-4">
                                        <div class="flex-1">
                                            <h4 class="font-bold text-lg">${article.title}</h4>
                                            <p class="text-xs text-gray-500 font-semibold">${formattedDate}</p>
                                        </div>
                                        <span class="text-indigo-600 hover:text-indigo-800 text-sm font-semibold flex-shrink-0 pt-1">
                                            <span class="group-open:hidden">Details</span>
                                            <span class="hidden group-open:inline">Less</span>
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-700 mt-2 pr-12 group-open:hidden">${synopsis}</p>
                                </summary>
                                <div class="mt-2 text-sm text-gray-700">
                                    <p>${article.content}</p>
                                </div>
                            </details>
                        `;
                        newsFeedContainer.appendChild(articleEl);
                    });
                }

                if (articles.length === articlesPerPage) {
                    loadMoreBtn.classList.remove('hidden');
                } else {
                    loadMoreBtn.classList.add('hidden');
                }

            } catch (error) {
                document.getElementById('news-error').classList.remove('hidden');
                console.error("Failed to fetch news:", error);
            } finally {
                newsLoader.classList.add('hidden');
                getNewsBtn.disabled = false;
                getNewsBtn.textContent = 'Get Global News';
            }
        }

        document.querySelectorAll('#news-categories button, #news-date-ranges button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const parent = e.target.parentElement;
                parent.querySelector('.active').classList.remove('active');
                e.target.classList.add('active');
            });
        });

        getNewsBtn.addEventListener('click', () => {
            currentNewsPage = 1;
            fetchNews(currentNewsPage);
        });

        loadMoreBtn.addEventListener('click', () => {
            currentNewsPage++;
            fetchNews(currentNewsPage);
        });

        // Initial fetch on page load
        fetchNews(1);
    });
    </script>
</body>
</html>

